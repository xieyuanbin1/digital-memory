(()=>{"use strict";var e,t;(t=e||(e={}))[t.onlyTop=1]="onlyTop",t[t.preferTop=2]="preferTop",t[t.desktop=3]="desktop";const o={active:[],deactive:[],login:[],logout:[],pay:[],orientation:[],network:[],swipe:[],token:[],permission:[],wallpaper:[],theme:[],language:[],safeArea:[],download:[]};window.addEventListener("message",(e=>{const t=e.data.cmd;o[t]&&(o[t].forEach(((t,o)=>{if("function"==typeof t)if(t.__edger_uid__){const o=e.data.uid;t.__edger_uid__===o&&(t(e.data.payload,e.data.error),t.__edger_done__=!0)}else t(e.data.payload,e.data.error)})),o[t]=o[t].filter((e=>!0!==e.__edger_done__)))}));const n=(e,t)=>{const n=e;o[n]?o[n].push(t):o[n]=[t]},r=(t,o=e.preferTop)=>{o===e.preferTop?window.parent===window.parent.parent?(console.warn("No app shell, downgrade to desktop",t),window.parent.postMessage({...t},"*")):window.parent.parent.postMessage({...t},"*"):o===e.onlyTop?window.parent===window.parent.parent?console.warn("No app shell, ignore message",t):window.parent.parent.postMessage({...t},"*"):window.parent.postMessage({...t},"*")};let i=0;const s=(t,o,s={timeout:1e3,ignoreResponse:!0,deliverStrategy:e.preferTop,disableTimeout:!1},a="")=>{if(!t)throw new Error("Illegal cmd");const{timeout:p=1e3,ignoreResponse:d=!0,deliverStrategy:l,disableTimeout:g=!1}=s;return new Promise(((e,s)=>{if(d)r({cmd:t,payload:o,ts:Date.now()},l),e(void 0);else{const d=`${Math.random()}-${Date.now()}-${i++}`,c=function(t,o){o?(console.error("error",o),s({error:o})):e(t)};c.__edger_uid__=d,n(t,c),r({cmd:t,payload:o,uid:d,ts:Date.now(),scope:a},l),g||setTimeout((()=>{s({error:`Timeout ${p} with cmd ${t}`,code:"timeout"})}),p||6e4)}}))},a=(t,n)=>{const r=o[t];r?(r.push(n),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})):console.warn(`The action you specified is unknown: ${t}`)},p={height:0,activeElement:{el:null,originToBottomHeight:0}},d=["top","left","right","bottom"],l={};let g,c,u;function m(){return c="CSS"in window&&"function"==typeof CSS.supports?CSS.supports("top: env(safe-area-inset-top)")?"env":CSS.supports("top: constant(safe-area-inset-top)")?"constant":"":"",c}function f(){if(c="string"==typeof c?c:m(),!c)return void d.forEach((e=>{l[e]=0}));function e(e,t){const o=e.style;Object.keys(t).forEach((e=>{const n=t[e];o[e]=n}))}const t=[];function o(e){e?t.push(e):t.forEach((e=>{e()}))}let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n={passive:!0}}});window.addEventListener("test",null,e)}catch(e){}u=document.createElement("div"),e(u,{position:"absolute",left:"0",top:"0",width:"0",height:"0",zIndex:"-1",overflow:"hidden",visibility:"hidden"}),d.forEach((t=>{!function(t,r){const i=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),p=document.createElement("div"),d={position:"absolute",width:"100px",height:"200px",boxSizing:"border-box",overflow:"hidden",paddingBottom:`${c}(safe-area-inset-${r})`};e(i,d),e(s,d),e(a,{transition:"0s",animation:"none",width:"400px",height:"400px"}),e(p,{transition:"0s",animation:"none",width:"250%",height:"250%"}),i.appendChild(a),s.appendChild(p),t.appendChild(i),t.appendChild(s),o((()=>{i.scrollTop=s.scrollTop=1e4;let e=i.scrollTop,t=s.scrollTop;function o(){this.scrollTop!==(this===i?e:t)&&(i.scrollTop=s.scrollTop=1e4,e=i.scrollTop,t=s.scrollTop,function(e){h.length||setTimeout((()=>{const e={};h.forEach((t=>{e[t]=l[t]})),h.length=0,v.forEach((t=>{t(e)}))}),0),h.push(e)}(r))}i.addEventListener("scroll",o,n),s.addEventListener("scroll",o,n)}));const g=getComputedStyle(i);Object.defineProperty(l,r,{configurable:!0,get:()=>parseFloat(g.paddingBottom)})}(u,t)})),document.body.appendChild(u),o(),g=!0}function y(e){return g||f(),l[e]}const h=[],v=[],w={get support(){return 0!=("string"==typeof c?c:m()).length},get top(){return y("top")},get left(){return y("left")},get right(){return y("right")},get bottom(){return y("bottom")},onChange:function(e){m()&&(g||f(),"function"==typeof e&&v.push(e))},offChange:function(e){const t=v.indexOf(e);t>=0&&v.splice(t,1)}},T=["top","left","right","bottom"];let S=!1;const _=()=>(S||(()=>{const e={top:w.top,left:w.left,right:w.right,bottom:w.bottom};T.forEach((t=>document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`)))})(),s("safeArea",{},{ignoreResponse:!1,timeout:500,deliverStrategy:e.desktop}).then((({safeAreaInsets:e})=>(T.forEach((t=>document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`))),S=!0,{safeAreaInsets:e}))).catch((()=>({safeAreaInsets:{top:w.top,left:w.left,right:w.right,bottom:w.bottom}})))),b=()=>{w.onChange((e=>{if(!S){const t=Object.keys(e);Array.isArray(t)&&t.length&&t.forEach((t=>{document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`)}))}})),_()};document.body?b():window.addEventListener("load",(()=>{b()}));const E={open:(t,o)=>s("open",{target:t,letter:o},{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4}),appworld:t=>s("openAppInWorld",{target:{id:t}},{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),letter:()=>s("letter",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.desktop}),browser:t=>s("openInBrowser",{url:t},{deliverStrategy:e.desktop,ignoreResponse:!1})},R={request:t=>s("reqPerms",{code:t.code,type:t.type},{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),fetch:()=>s("permission",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop})},k={qrscan:()=>s("qrscan",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:3e5,disableTimeout:!0}),qrscanStop:()=>{s("qrscanStop",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4})},contacts:()=>s("contacts",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:5e4}),version:()=>s("version",{},{deliverStrategy:e.onlyTop,ignoreResponse:!1,timeout:1e3})},C={download:(t,o,n)=>s("downloadFile",{uri:t,options:o,headers:n},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}),abort:t=>s("downloadAbort",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}),state:t=>s("downloadState",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4})},A={open:t=>s("openFile",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4})},x={state:()=>s("orientation",{},{deliverStrategy:e.preferTop,ignoreResponse:!1}),lock:t=>s("setOrientation",{type:"lock",orientation:t},{deliverStrategy:e.preferTop,ignoreResponse:!1}),unlock:()=>s("setOrientation",{type:"unlock"},{deliverStrategy:e.preferTop,ignoreResponse:!1})},B={pay:t=>s("payRequest",t,{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4})},$={safeArea:_},I={_on:n,_off:function(e){const t=e;return this.removeAllListeners(t)},_emit:r,_cmd:s,onAction:a,addEventListener:function(t,n){if("function"!=typeof n)throw new TypeError("listener must be a function");const r=o[t];return r&&(r.push(n),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})),this},removeEventListener:function(e,t){if("function"!=typeof t)throw new TypeError("listener must be a function");return o[e]&&(o[e]=o[e].filter((e=>e!==t))),this},removeAllListeners:function(e){return e?o[e]&&(o[e]=[]):Object.keys(o).forEach((e=>{o[e]&&(o[e]=[])})),this},user:()=>s("user",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.desktop}),avoidKeyboardOverlay:(t="#app",o=".van-dialog")=>window.addEventListener("message",(n=>{if("keyboardHeight"===n.data.cmd){let i=0,s=document.querySelector(t);const a=document.documentElement.clientHeight||document.body.clientHeight,d=document.activeElement;let l=document.activeElement;const g=+n.data.payload.keyboardHeight,c=document.querySelectorAll(o),u=Array.from(c).filter((e=>"none"!==e.style.display))[0],m=u&&"none"!==u.style.display;if(m&&(s=u,l=u,i=l.getBoundingClientRect().top),s.style.transition||(s.style.transition="margin-top .3s ease-in-out"),g||(p.height=0,p.activeElement.el=null,p.activeElement.originToBottomHeight=0,s.style.marginTop="0px"),g>0&&d&&("INPUT"===d.tagName.toUpperCase()||"TEXTAREA"===d.tagName.toUpperCase())){let t=!1,o=a-l.getBoundingClientRect().bottom;if(p.height){const e=p.activeElement.originToBottomHeight;if(e){let n=0;try{n=parseFloat(getComputedStyle(s).marginTop.replace(/[px ]/g,""))}catch(e){console.error("计算keyboard marginTop出错",e)}let r=a-d.getBoundingClientRect().bottom+n,i=0,l=40;p.activeElement.el&&(l=10,i=a-p.activeElement.el.getBoundingClientRect().bottom+n-p.activeElement.originToBottomHeight),r-=i,t=Math.abs(r-e)>l,o=t?r:e}}if(!t&&g<=p.height&&p.height-g<150)return;if(t||o<g){p.activeElement.el=d,p.activeElement.originToBottomHeight=o,p.height=g;let t=o-g;i>0&&(t=i-Math.abs(t)>25?t:25-i),t>=0&&(t=0),s.style.marginTop=t+"px",m||r({cmd:"switchStatusBar",payload:"hide"},e.onlyTop)}}else s.style.marginTop="0px",c.length&&Array.from(c).forEach((e=>e.style.marginTop="0px")),r({cmd:"switchStatusBar",payload:"show"},e.onlyTop)}})),app:E,notify:(P={},H=t=>{t&&["info","warning","error","success"].forEach((o=>{t[o]=t=>{s("notify",{message:t,level:o},{deliverStrategy:e.desktop,ignoreResponse:!0})}}))},P?H(P):console.error("target object is null"),P),mobile:k,permission:R,payment:B,apps:(t,o=!1)=>s("apps",{appids:t,ico:o},{deliverStrategy:e.desktop,ignoreResponse:!1}),orientation:x,network:()=>s("network",{},{ignoreResponse:!1,deliverStrategy:e.preferTop}),language:()=>s("language",{},{deliverStrategy:e.desktop,ignoreResponse:!1}),version:()=>s("version",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.desktop}),token:()=>s("token",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.desktop}),enableHistoryNavigation:()=>{window.sessionStorage.getItem("entryPath")||window.sessionStorage.setItem("entryPath",window.location.href),a("swipe",(function(e){"left"!==e.direction&&"right"!==e.direction||(window.sessionStorage.getItem("entryPath")!==window.location.href?window.history.back():r({cmd:"minEap"},3))}))},theme:()=>s("theme",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.preferTop}),env:()=>s("env",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.preferTop}),layout:$,downloadTask:C,filesystem:A};var P,H;((t=10)=>{setInterval((()=>{s("ping",{},{ignoreResponse:!0,timeout:200,deliverStrategy:e.desktop})}),1e3*t)})(30),s("__edgeros_register__",{},{deliverStrategy:e.desktop,ignoreResponse:!0}),s("__edgeros_register__",{},{deliverStrategy:e.onlyTop,ignoreResponse:!0}),window.edger=I})();